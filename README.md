# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

Набор типов категорий карточек

```
export type ItemCategory = 'софт-скил' | 'хард-скил' | 'другое' | 'дополнительное' | 'кнопка';
```

Карточка товара

```
export interface IProductItem {
  id: string; - id товара 
  description?: string; - описание товара 
  image: string; - изображение товара 
  title: string; - имя товара
  category: string; - категория товара 
  price: string; - цена товара
}
```

Интерфейс для модели данных карточек товара

```
export interface IProductsData {
  cards: IProductItem[];
  preview: string | null;
  setCatalog(items: IProductItem[]): IProductItem;
  setPreview(item: IProductItem) : IProductItem;
}
```

Данные карточки, используемые в корзине

```
export type IBasketItem = Pick<IProductItem, 'id' | 'title' | 'price'> ;
```

Интерфейс для модели данных корзины

```
export interface IBasketModal{
  items: IBasketItem[];
  add(items: IBasketItem): void;
  remove(item: IBasketItem): void;
  getTotalPrice(): number;
  clearBasket(): void;
}
```

Набор типов оплаты

```
export type PaymentMethod = Pick<IOrder, 'payment'>;
```

Данные для отправки на сервер информации о совершенном заказе

```
export interface IOrder{
  paymentMethod: PaymentMethod;
  total: number;
  items: string[];
  email: string;
  phone: string;
  address: string;
};
```

Данные, используемые в форме способа оплаты

```
export type IOrderForm = Pick<IOrder, 'paymentMethod' | 'address'>;
```

Данные, используемые в форме контактов

```
export type IUserForm = Pick<IOrder, 'email' | 'phone'>;
```

Данные, используемые в форме успешной оплаты

```
export type IResultForm = Pick<IOrderResult, 'total'>;
```

Данные, полученные при успешной покупке

```
export interface IOrderResult {
  id: string;
  total: number;
}
```

Данные, используемые для обработки ошибок валидации

```
export type OrderFormErrors = Partial<Record<keyof IOrderForm, string>>;
export type UserFormErrors = Partial<Record<keyof IUserForm, string>>;
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных,
- презентер, отвечает за связь представления и данных

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
-  constructor(baseUrl: string, options: RequestInit = {}) - принимает базовый URL и глобальные опции для всех запросов(опционально). 

Методы:
- protected `handleResponse` - служит для обработки запросов сервера.
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на событие, происходящее в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом `IEvents` :
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

### Слой данных

#### Класс ProductData
Класс отвечает за хранение данных карточек, полученных с сервера
В полях класса хранятся следущие данные:
- cards: IProductItem[] - массив объектов карточек продуктов
- preview: string | null - id карточки, выбранной для просмотра в модальном окне
- orderForm: IOrderForm = {
    payment: '',
    address: ''
  } - 
- userForm: IUserForm = {
    email: '',
    phone: ''
  } - 
- basketModal: IBasketModal = new BasketModal() - 
- orderFormErrors: OrderFormErrors = {} - пустой объект для обраотки ошибок
- userFormErrors: UserFormErrors = {} - пустой объект для обраотки ошибок

Методы: 
- setCatalog(items: IProductItem[]): IProductItem - возвращает карточку при срабатывании события
- setPreview(item: IProductItem) : IProductItem - возвращает карточку по ёё id
- setOrderField(field: keyof IOrderForm, value: string) - заполняет поля формы и запускает валидацию
- setUserField(field: keyof IUserForm, value: string) - заполняет поля формы и запускает валидацию
- validateOrder() - производит валидацию формы
- validateUser() - производит валидацию формы

#### Класс Basket Modal
Класс отвечает за получение, хранение, добавление и удаление карточек товара в корзине, очистку корзины и заполнение общей цены товаров.
В полях класса хранятся следущие данные:
- _items: IBasketItem[] - массив карточек товаров, добавленных в корзину
Методы:
- add(item: IBasketItem) - служит для добавления новых карточек товаров в корзину
- remove(item: IBasketItem) - служит для удаления карточек товаров из корзины
- getTotalPrice() - устанавливает общую цену всех товаров
- clearBasket() - очищает корзину

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данные.

#### Класс Modal
Реализует модальное окно. Устанавливвет слушатель для закрытия модального окна на клик в оверлей и енопку-крестик сеттер для очистки от всех дочерних элементов.
- constructor(protected container: HTMLElement, protected events: IEvents) Конструктор принимает контент модального окна и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса
- _content: HTMLElement - элемент модального окна
- _closeButton: HTMLButtonElement;

Методы:
- open() - для открытия модального окна
- close() - для закрытия модального окна
- render (data: IModalData): HTMLElement - служит для отоборажения модального окна

#### Класс Card
class Card<T> extends Component<ICard<T>>
Отвечает за отображение карточки, задавая в карточке все данные. Класс используется для отображения карточек на странице сайта. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
- constructor(protected blockName: string, container: HTMLElement, actions?: ICardActions) - принимает имя блока и событие клика
Поля класса содержат элементы разметки элементов карточки.
Методы:
- сетттеры - заполняют атрибуты элементов карточки данными.
- геттеры - возвращают значения элементов карточки.
- buttonDeleteInBasket (value: string) - меняет текст кнопки, при добавлении в корзину

#### Класс CatalogItem
class CatalogItem<T> extends Card<T>
Отвечает за отображение блока с карточками на главной странице. В конструктор принимает контейнер, в котором размещаются карточки и слушаетель клика.
- constructor(container: HTMLElement, actions?: ICardActions) {
        super('card', container, actions);
    }
- сеттер, который в зависимости от категории товара меняет цвет текста.

#### Класс Form
Отвечает за общий вид и валидацию форм, навешает слушатель на событие `submit`.
- constructor(protected container: HTMLFormElement, protected events: IEvents) - Конструктор принимает контент формы и экземпляр класса `EventEmitter` для возможности инициации событий. И реализует методы:
- protected onInputChange(field: keyof T, value: string) - срабатывает при изменении полей для проверки на валидность.
- render(state: Partial<T> & IFormState) - для отображения формы.
- сеттер для блокировки кнопки
- сеттер для вывода текста ошибки

#### Класс OrderForm
Является наследником класса Form и служит для заполнения формы с методом оплаты и адресом.
В конструктор класса передается DOM элемент формы, что позволяет при необходимости формировать формы разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
Поля класса содержат элементы разметки элементов формы. Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий и слушатель клика.
- constructor(container: HTMLFormElement, events: IEvents, actions?: TabActions)
Методы:
- сетттеры - заполняют атрибуты элементов формы данными.
- геттеры - возвращают значения элементов формы.

#### Класс UserForm
Являются наследником класса Form и служит для заполнения формы контактных данных.
В конструктор класса передается DOM элемент формы, что позволяет при необходимости формировать формы разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
Поля класса содержат элементы разметки элементов формы. Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.
-  constructor(container: HTMLFormElement, events: IEvents)
Методы:
- сетттеры - заполняют атрибуты элементов формы данными.

#### Класс Success
class Success extends Component<ISuccess>

В конструктор класса передается DOM элемент, что позволяет при необходимости формировать разные варианты верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
Поля класса содержат элементы разметки элементов формы. Конструктор, кроме темплейта принимает слушатель клика.
- constructor(container: HTMLElement, actions: ISuccessActions)
Методы:
- сетттеры - заполняют атрибуты элементов формы данными.

### Слой коммуникации

#### Класс ProductApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.
- constructor(cdn: string, baseUrl: string, options?: RequestInit).

Методы:
- getProductItem(id: string): Promise<IProductItem> - делает запрос на сервер для получения данных одной карточки по id.
- getProductList(): Promise<IProductItem[]> - делает запрос на сервер и получает в ответ массив карточек.
- orderProduct(orderForm: IOrderForm, userForm: IUserForm, basketModel: IBasketModal ): Promise<IOrderResult> - отправляет на сервер данные заказа и получает ответ об успешной оплате.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `orderPayment:change` - 
- `card:open` - открытие модального окна карточки
- `bids:open` - открытие модального окна корзины
- `basket:change` - изменение в корзине
- `addInbasket:change` - добавление товара в корзину
- `removeFromBasket:change` - удаление товара из корзины по кнопке в корзине
- `card:changed` - измения в карточке при удаление товара из корзины
- `removeInCardFromBasket:change` - удаление товара из корзины по кнопке в карточке
- `preview:changed` - изменена открытая выбранная карточка
- `order:open` - открытие модального окна с формой оплаты
- `order:submit` - сохранение данных адреса и оплаты в модальном окне
- `orderFormErrors:change` - изменилось состояние валидации формы
- `userFormErrors:change` - изменилось состояние валидации формы
- `/^order\..*:change/` - изменилось одно из полей формы
- `/^contacts\..*:change/` - изменилось одно из полей формы
- `contacts:submit` - сохраняет контактные данный и отправляет данные заказа на сервер
- `modal:open` - блокируем прокрутку страницы если открыта модалка
- `modal:close` - разблокируем прокрутку страницы если закрыты модалка
